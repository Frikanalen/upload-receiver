#!/usr/bin/env python3
""" This script is invoked by tusd upon successful reception of a complete file.

"""
import json
import sys
from loguru import logger

def read_upload_status():
    """ Reads the JSON data from tusd, and returns a tuple of numeric video ID, original
    file name, and S3 key.

    Example JSON data:

    "Upload": {
        "ID": "9a1a39798141223fb20f133f2bc58535+2~Qe1PIASV0XqmPse9fP-oq6PMzy-ZvdD",
        "IsFinal": false,
        "IsPartial": false,
        "MetaData": {
            "fileName": "IMG_1133.MOV",
        },
        "Offset": 9844291,
        "PartialUploads": null,
        "Size": 9844291,
        "SizeIsDeferred": false,
        "Storage": {
            "Bucket": "incoming",
            "Key": "9a1a39798141223fb20f133f2bc58535",
            "Type": "s3store"
        }
    }
    """
    s = json.load(sys.stdin)["Upload"]
    return (s["MetaData"]["fileName"], s["Storage"]["Key"])


if __name__ == '__main__':
    fileName, objectKey = read_upload_status()
